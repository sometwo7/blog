---
title: Redis
tags:
  - Java
  - Redis
categories:
  - Java学习
comments: true
abbrlink: bae4ff13
date: 2019-10-04 19:49:28
---
# Redis

## 1. redis 是什么？都有哪些使用场景？

- redis 是一个开源的，使用 C 语言编写，支持网络，可基于内存，可持久化的日志型、键值对数据库，并提供多种语言的API接口；

- redis 使用场景主要有三种
 - 高并发的数据读写
 - 海量数据的读写
 - 对扩展性要求的高的数据

<!-- more -->

## 2. redis 有哪些功能？

- 数据缓存
- 分布式锁
- 支持数据持久化
- 支持事物
- 支持消息队列

## 3. redis 和 memcache 有什么区别？

- 存储数据类型，memcahe 存储的所有数据均为字符串，redis 支持更丰富的数据类型；
- 响应速度，redis 快于 memcache；
- 数据持久化， redis 支持，而 memcache 不支持；
- redis 是单进程单线程的，memcache 是单进程多线程的。

## 4. redis 为什么是单线程的？

- redis 处理用户的网络请求是单线程处理，在执行数据持久化时就不是单线程了，并且从 redis4.0 开始某些操作支持多线程；
- 因为Redis是基于内存的操作，CPU不是Redis的瓶颈，Redis的瓶颈最有可能是机器内存的大小或者网络带宽；
- 既然单线程容易实现，而且CPU不会成为瓶颈，多线程方案会加重系统的复杂性，因此采用单线程方案。

## 5. 什么是缓存穿透？怎么解决？

- 缓存穿透，
 - 查询一个一定不存在的数据，由于缓存不命中时需要从数据库中查询，查不到数据就不写入缓存；
 - 这将导致这个不存在的数据，每次请求都要到数据库去查询，造成缓存穿透。

- 解决方案，
 - 如果一个查询返回的数据为空（不管是数据不存在，还是系统故障），我们就把这个空结果进行缓存，
 - 设置它的过期时间很短，最长不超过五分钟。

## 6. redis 支持的数据类型有哪些？

- redis 支持五种数据类型，string 字符串， list 列表， hash 哈希， set 集合， zset 有序集合；

- String，
 - 一个 key 对应一个 value；
 - 是二进制安全的，可以包含任何数据；
 - string 类型的值最大能存储 512MB；

- List，
 - 简单的字符串列表，按照插入顺序排序；
 - 可以在列表的头部或尾部插入数据；

- Hash，
 - 一个 key 对应一个 键值对集合；
 - 集合是 string 类型的 field 和 value 的映射表，可以存储对象；

- Set，
 - string 的无序集合；
 - 通过哈希表实现，因此增删改查时间复杂度是O(1);

- Zset
 - string 类型的数据集合，但是不允许重复的值；
 - 每个元素都关联一个 double 类型的分数，根据分数来排序，元素不能有重复值，但是分数可以重复。

## 7. redis 支持的 java 客户端都有哪些？

- Redisson、Jedis、lettuce

## 8. jedis 和 redisson 有哪些区别？

- Jedis是Redis的Java实现的客户端，其API提供了比较全面的Redis命令的支持；

- Redisson实现了分布式和可扩展的Java数据结构，和Jedis相比，功能较为简单，不支持字符串操作，不支持排序、事务、管道、分区等Redis特性。

- Redisson的宗旨是促进使用者对Redis的关注分离，从而让使用者能够将精力更集中地放在处理业务逻辑上。

## 9. 怎么保证缓存和数据库数据的一致性？

- 合理设置缓存的过期时间，保证最终一致性；
 - 我们可以对存入缓存的数据设置过期时间，所有的写操作以数据库为准，对缓存操作只是尽最大努力即可；
 - 也就是说如果数据库写成功，缓存更新失败，那么只要到达过期时间，则后面的读请求自然会从数据库中读取新值然后回填缓存；

- 先删除缓存，再更新数据库，延时一定时间再次删除缓存；

- 先更新数据库，再删缓存；

- 针对删除缓存失败的情况，增加重试机制；
 - （1）更新数据库数据
 - （2）数据库会将操作信息写入binlog日志当中
 - （3）订阅程序提取出所需要的数据以及key
 - （4）另起一段非业务代码，获得该信息
 - （5）尝试删除缓存操作，发现删除失败
 - （6）将这些信息发送至消息队列
 - （7）重新从消息队列中获得该数据，重试操作。

## 10. redis 持久化有几种方式？

- Redis 的持久化有两种方式；

- RDB（Redis Database），指定的时间间隔能对你的数据进行快照存储；

- AOF（Append Only File），每一个收到的写命令都通过write函数追加到文件中。

## 11. redis 怎么实现分布式锁？

- Redis 分布式锁，就是获取锁的时候在 redis 里设置一个值，释放锁的时候删除 redis 里的这个值；

- 其他程序要获取锁的时候，查询值是否存在，

- 若不存在则设置值，成功获取锁，就可以继续执行，

- 若存在则获取锁失败，就只能放弃或稍后重试。


## 12. redis 分布式锁有什么缺陷？

- Redis 分布式锁不能解决超时的问题，
- 分布式锁有一个超时时间，程序的执行如果超出了锁的超时时间就会出现问题。

## 13. redis 如何做内存优化？

- 尽可能使用散列表（hashes），散列表（是说散列表里面存储的数少）使用的内存非常小，所以你应该尽可能的将你的数据模型抽象到一个散列表里面。

- 比如你的web系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的key,而是应该把这个用户的所有信息存储到一张散列表里面。

## 14. redis 淘汰策略有哪些？

- volatile-lru：从已设置过期时间的数据集（server. db[i]. expires）中挑选最近最少使用的数据淘汰。
- volatile-ttl：从已设置过期时间的数据集（server. db[i]. expires）中挑选将要过期的数据淘汰。
- volatile-random：从已设置过期时间的数据集（server. db[i]. expires）中任意选择数据淘汰。
- allkeys-lru：从数据集（server. db[i]. dict）中挑选最近最少使用的数据淘汰。
- allkeys-random：从数据集（server. db[i]. dict）中任意选择数据淘汰。
- no-enviction（驱逐）：禁止驱逐数据。

## 15. redis 常见的性能问题有哪些？该如何解决？

- 主服务器写内存快照，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务，所以主服务器最好不要写内存快照。

- Redis 主从复制的性能问题，为了主从复制的速度和连接的稳定性，主从库最好在同一个局域网内。
